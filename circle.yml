machine:
  timezone:
    Europe/Amsterdam
  ruby:
    version: 2.3.3
dependencies:
  pre:
    - ./bin/gemnasium_install
test:
  override:
    - bundle exec rspec spec:
        environment:
          RAILS_ENV: test
          RACK_ENV: test
    - bundle exec rubocop
    - ./bin/gemnasium
deployment:
  staging:
    branch: master
    commands:
      - git remote add staging git@heroku.com:physiqual.git
      - '[[ ! -e "$(git rev-parse --git-dir)/shallow" ]] || git fetch --unshallow'
      - git push -f staging $CIRCLE_SHA1:refs/heads/master
  production:
    branch: production
    commands:
      - git remote add production git@heroku.com:physiqual.git
      - '[[ ! -e "$(git rev-parse --git-dir)/shallow" ]] || git fetch --unshallow'
      - git push -f production $CIRCLE_SHA1:refs/heads/master
